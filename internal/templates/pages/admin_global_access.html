{{define "title"}}Admin: Global Access - asiakirjat{{end}}

{{define "content"}}
<div class="admin-page">
    <h1>Global Access Rules</h1>

    <div class="admin-nav">
        <a href="{{url "/admin/projects"}}" class="admin-nav-link">Projects</a>
        <a href="{{url "/admin/users"}}" class="admin-nav-link">Users</a>
        <a href="{{url "/admin/robots"}}" class="admin-nav-link">Robot Users</a>
        <a href="{{url "/admin/groups"}}" class="admin-nav-link">Group Mappings</a>
        <a href="{{url "/admin/global-access"}}" class="admin-nav-link active">Global Access</a>
    </div>

    <div class="admin-info">
        <p>Control who can access projects with <strong>private</strong> visibility. Users, LDAP groups, or OAuth2 groups listed here receive access to all private projects at the specified role.</p>
        <p><strong>Note:</strong> Rules marked as "Config" were loaded from the <code>access.private</code> section in the config file and cannot be modified through this UI.</p>
    </div>

    {{if .Flash}}
    <div class="flash flash-{{.Flash.Type}}">{{.Flash.Message}}</div>
    {{end}}

    <div class="admin-create-form">
        <h2>Add Rule</h2>
        <form method="POST" action="{{url "/admin/global-access"}}">
            <div class="form-row">
                <div class="form-group">
                    <label for="subject_type">Type</label>
                    <select id="subject_type" name="subject_type" required>
                        <option value="user">User</option>
                        <option value="ldap_group">LDAP Group</option>
                        <option value="oauth2_group">OAuth2 Group</option>
                    </select>
                </div>
                <div class="form-group form-group-wide">
                    <label for="subject_identifier">Identifier</label>
                    <input type="text" id="subject_identifier" name="subject_identifier" required
                        placeholder="username, LDAP DN, or OAuth2 group name">
                </div>
                <div class="form-group">
                    <label for="role">Role</label>
                    <select id="role" name="role" required>
                        <option value="viewer">Viewer</option>
                        <option value="editor">Editor</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Add Rule</button>
            </div>
        </form>
    </div>

    {{if .Rules}}
    <table class="admin-table">
        <thead>
            <tr>
                <th>Type</th>
                <th>Identifier</th>
                <th>Role</th>
                <th>Source</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {{range .Rules}}
            <tr>
                <td><span class="badge badge-{{.SubjectType}}">{{.SubjectType}}</span></td>
                <td class="group-id">{{.SubjectIdentifier}}</td>
                <td>{{.Role}}</td>
                <td>
                    {{if .FromConfig}}
                    <span class="badge badge-config badge-small">Config</span>
                    {{else}}
                    <span class="badge badge-manual badge-small">Manual</span>
                    {{end}}
                </td>
                <td>
                    {{if not .FromConfig}}
                    <form method="POST" action="{{url "/admin/global-access/"}}{{.ID}}/delete" class="inline-form"
                        onsubmit="return confirm('Remove this global access rule?')">
                        <button type="submit" class="btn btn-small btn-danger">Delete</button>
                    </form>
                    {{end}}
                </td>
            </tr>
            {{end}}
        </tbody>
    </table>
    {{else}}
    <p class="empty-message">No global access rules configured. Add one above or configure <code>access.private</code> in your config file.</p>
    {{end}}
</div>

<style>
.admin-info {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 4px;
    padding: 1rem;
    margin-bottom: 1.5rem;
}
.admin-info p {
    margin: 0 0 0.5rem 0;
}
.admin-info p:last-child {
    margin-bottom: 0;
}
.form-group-wide {
    flex: 2;
}
.badge {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 3px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}
.badge-small {
    padding: 0.125rem 0.375rem;
    font-size: 0.625rem;
}
.badge-user {
    background: #e8f5e9;
    color: #2e7d32;
}
.badge-ldap_group {
    background: #e3f2fd;
    color: #1565c0;
}
.badge-oauth2_group {
    background: #f3e5f5;
    color: #7b1fa2;
}
.badge-config {
    background: #fff3e0;
    color: #e65100;
}
.badge-manual {
    background: #e8eaf6;
    color: #283593;
}
.group-id {
    font-family: monospace;
    font-size: 0.875rem;
    word-break: break-all;
    max-width: 400px;
}
.empty-message {
    color: var(--color-text-muted);
    text-align: center;
    padding: 2rem;
}
.flash {
    padding: 1rem;
    border-radius: 4px;
    margin-bottom: 1rem;
}
.flash-success {
    background: #e8f5e9;
    color: #2e7d32;
    border: 1px solid #a5d6a7;
}
.flash-error {
    background: #ffebee;
    color: #c62828;
    border: 1px solid #ef9a9a;
}
.inline-form {
    display: inline;
}
</style>
{{end}}
